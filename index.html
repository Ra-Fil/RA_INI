<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Můj první Google vyhledávač</title>

<style>
        #results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: #f5f5f5; /* Světle šedé pozadí */
        }

        #results-table th, #results-table td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: left;
        }

        #results-table th {
            background-color: #ddd;
        }

        #results-container {
            margin-top: 20px;
        }
    </style>

</head>
<body>
    <h1>Google vyhledávač</h1>
    
    <form id="scraper-form">
        <label for="keyword">Sem zadej klíčové slovo nebo frázi:</label>
        <input type="text" id="keyword" name="keyword" required>
        <button type="submit">Vyhledej</button>
    </form>
    <p id="status"></p>

        <div id="download-container" style="display: none;">
    <a id="download-btn">Stáhnout CSV</a>
</div>

<!-- Kontejner pro výsledky -->
<div id="results-container" style="margin-top: 20px;"></div>
    
    
<script>
    document.getElementById('scraper-form').addEventListener('submit', async function(e) {
    e.preventDefault(); // Zabrání standardnímu odeslání formuláře
    const keyword = document.getElementById('keyword').value;
    document.getElementById('status').innerText = 'Už se to hledá...';
    document.getElementById('download-container').style.display = 'none';
    document.getElementById('results-container').innerHTML = ''; // Vyčistí předchozí výsledky

    try {
        const response = await fetch('https://ra-ini.onrender.com/scrape', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ keyword })
        });

        if (response.ok) {
            const blob = await response.blob();
            const text = await blob.text(); // Převede blob na text
            console.log('Response text:', text); // Výpis odpovědi pro ladění

            // Zpracování CSV na řádky a sloupce
            const rows = text.split('\n'); // Rozdělení podle řádků
            const results = rows.slice(1).map(row => row.split(',')); // Rozdělení podle čárek a odstranění hlavičky

            // Vypíše výsledky do kontejneru
            const resultsContainer = document.getElementById('results-container');
            results.forEach(result => {
                if (result.length >= 3) {
                    const [title, link, snippet] = result;
                    const resultDiv = document.createElement('div');
                    resultDiv.style.marginBottom = '10px';
                    resultDiv.innerHTML = `
                        <h3>${title}</h3>
                        <p><a href="${link}" target="_blank">${link}</a></p>
                        <p>${snippet}</p>
                    `;
                    resultsContainer.appendChild(resultDiv);
                }
            });

            // Nastaví URL pro stažení CSV
            const url = window.URL.createObjectURL(blob);
            const downloadBtn = document.getElementById('download-btn');
            downloadBtn.href = url;
            downloadBtn.download = 'results.csv';
            document.getElementById('download-container').style.display = 'block';
            document.getElementById('status').innerText = 'Vyhledávání dokončeno :) Pokud chceš data uložit ve formátu CSV do svého počítače, klikni na tlačítko.';
        } else {
            document.getElementById('status').innerText = 'Chybička se vloudila, zkus to prosím znovu.';
        }
    } catch (error) {
        console.error('Error:', error);
        document.getElementById('status').innerText = 'A jeeeje, asi mi to nefunguje. Zkus to později.';
    }
});


</script>

</body>
</html>
